# 登录注册功能说明

## 功能概述

本项目实现了完整的用户认证系统，包括：

- 用户登录
- 用户注册（需要邀请码验证）
- 邮箱验证
- 受保护的路由
- 用户登出

## 功能特性

### 1. 登录页面 (`/login`)
- 邮箱和密码登录
- 表单验证
- 登录成功后自动跳转到之前访问的页面
- 支持记住登录状态

### 2. 注册页面 (`/register`)
- 三步注册流程：
  1. 验证邀请码（`vlinker888`）
  2. 填写邮箱和密码信息
  3. 发送注册邮件确认

### 3. 邀请码验证
- 硬编码邀请码：`vlinker888`
- 验证成功后才能进入下一步注册流程

### 4. 邮箱注册
- 使用 Supabase Auth 进行用户注册
- 发送确认邮件到用户邮箱
- 支持邮件确认链接

### 5. 路由保护
- 所有业务页面都需要登录才能访问
- 未登录用户自动重定向到登录页面
- 登录成功后跳转到原目标页面

### 6. 用户状态管理
- 使用 React Context 管理用户状态
- 支持全局用户信息访问
- 自动检查登录状态

## 技术实现

### 文件结构
```
src/
├── pages/
│   ├── Login.tsx              # 登录页面
│   ├── Register.tsx           # 注册页面
│   └── AuthCallback.tsx       # 认证回调页面
├── components/
│   └── Auth/
│       └── ProtectedRoute.tsx # 受保护的路由组件
├── contexts/
│   └── AuthContext.tsx        # 认证上下文
└── lib/
    └── authApi.ts             # 认证相关API
```

### 主要组件

#### Login.tsx
- 登录表单
- 邮箱和密码验证
- 登录状态管理
- 错误处理

#### Register.tsx
- 三步注册流程
- 邀请码验证
- 邮箱注册
- 进度指示器

#### ProtectedRoute.tsx
- 路由保护逻辑
- 登录状态检查
- 重定向处理

#### AuthContext.tsx
- 全局用户状态管理
- 登录状态检查
- 用户信息更新

#### authApi.ts
- 登录API
- 注册API
- 邀请码验证
- 邮件发送
- 登出API

## 使用说明

### 1. 用户注册流程
1. 访问 `/register` 页面
2. 输入邀请码 `vlinker888`
3. 验证邀请码成功后，填写邮箱和密码
4. 点击发送注册邮件
5. 查收邮箱中的确认邮件
6. 点击邮件中的确认链接完成注册

### 2. 用户登录流程
1. 访问 `/login` 页面
2. 输入注册时使用的邮箱和密码
3. 点击登录按钮
4. 登录成功后自动跳转到主页面

### 3. 用户登出
1. 点击右上角的用户头像
2. 选择"退出登录"
3. 系统会清除登录状态并跳转到登录页面

## 配置说明

### 邀请码配置
在 `src/lib/authApi.ts` 中修改 `validInviteCode` 变量：
```typescript
const validInviteCode = 'vlinker888'; // 修改为你的邀请码
```

### Supabase 配置
确保在 `src/lib/supabase.ts` 中正确配置了 Supabase 客户端：
```typescript
const supabaseUrl = 'YOUR_SUPABASE_URL';
const supabaseAnonKey = 'YOUR_SUPABASE_ANON_KEY';
```

### 邮件配置
在 Supabase 控制台中配置邮件模板和SMTP设置。

## 安全特性

1. **密码验证**：密码至少6位字符
2. **邮箱验证**：使用有效的邮箱格式
3. **邀请码验证**：防止未授权注册
4. **路由保护**：未登录用户无法访问受保护页面
5. **会话管理**：自动检查登录状态
6. **安全登出**：清除所有会话信息

## 扩展功能

### 添加新的邀请码
1. 修改 `src/lib/authApi.ts` 中的验证逻辑
2. 可以连接数据库存储邀请码
3. 支持邀请码使用次数限制

### 添加邮件模板
1. 在 Supabase 控制台配置邮件模板
2. 自定义邮件内容和样式
3. 支持多语言邮件

### 添加第三方登录
1. 配置 OAuth 提供商
2. 添加第三方登录按钮
3. 处理第三方登录回调

## 故障排除

### 常见问题

1. **登录失败**
   - 检查邮箱和密码是否正确
   - 确认用户已完成邮箱验证
   - 检查网络连接

2. **注册失败**
   - 确认邀请码正确
   - 检查邮箱格式
   - 确认密码符合要求

3. **邮件未收到**
   - 检查垃圾邮件文件夹
   - 确认邮箱地址正确
   - 检查 Supabase 邮件配置

4. **页面无法访问**
   - 确认已登录
   - 检查路由配置
   - 清除浏览器缓存

## 开发说明

### 本地开发
```bash
npm run dev
```

### 构建生产版本
```bash
npm run build
```

### 代码检查
```bash
npm run lint
```

## 更新日志

- v1.0.0: 初始版本，包含基本的登录注册功能
- 支持邀请码验证
- 支持邮箱注册
- 支持路由保护
- 支持用户状态管理 